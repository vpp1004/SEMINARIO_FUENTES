---
title: "SeminarioCancer"
author: 
- "Vanessa Pérez"
- "Carmen Gómez Peña"
date: "`r Sys.Date()`"
output: html_document
---

Enlace a repositorio de [Github](https://github.com/vpp1004/SEMINARIO_FUENTES)



### Introducción
En este seminario vamos a estudiar la enfermedad del cancer y su relación con distintas variables que pueden influir en ella positiva o negativamente en las distintas comunidades de España.
En específico, las variables que estudiaremos son los casos de personas que realizan actividad física habitualmente, los casos de consumidores habituales de alcohol y el número de zonas verdes de cada lugar.




###Objetivos 

* ¿Cómo influyen individualmente el indice verde, el alcohol y el ejercicio sobre el cáncer?

* Tiene más influencia lo considerado bueno para la salud (ejercicio y porcentaje verde) que lo malo (alcohol) sobre el cancer 
* ¿Están todas estas variables directamente relacionadas con el cancer ?


```{r setup, include=FALSE}

options(repos = c(CRAN = "https://cloud.r-project.org/"))
```
####Instalación de paquetes necesarios para el desarrollo del proyecto 
Aquí se encuentran los paquetes que hay que instalar para poder ejecutar este proyecto, en caso de tener estos paquetes ya instalados no ha de ejecutarse esta celda. 
Estos paquetes contienen funciones básicas necesarias para el tratamiento de archivos json y pcaxis que nos permiten desarrollar investigación sobre ellos 

```{r}
###  CARGA DE PAQUETES:
#install.packages("pxR")
#install.packages("tidyverse")
#install.packages("rjson")
#install.packages("tidyjson")
#install.packages("json")
#install.packages("ggplot2")
```


#### Carga de librerías necesarias para realizar el proyecto 

Una vez que se ha producido la instalación de los paquetes para poder realizar cualquier función necesitamos cargar las librerías instaladas para poder utilizarlas. La siguiente celda contiene las librerías necesarias para poder realizar el proyecto 
```{r}
library(pxR)
library(tidyverse)
library(rjson)
library(tidyjson)
library(jsonlite)
library(dplyr)
library(RJSONIO)
library(ggplot2)
```

#### Subida de archivos necesarios 
En este proyecto vamos a trabajar con diferentes archivos tanto json como pcaxis,además de trabajar con datos directamente de un repostitorio por tanton necesitamos incluir los archivos para trabajar con ellos 

#####Carga de datos de consumo de alcohol (pcaxis)
Encontramos los datos de personas que habitualmente consumen alcohol por las diferentes comunidades de España 
```{r}
casos_alcohol<-read.px("INPUT/DATA/CASOS_ALCOHOL/CasosAlcoholComunidades.px")
dtalcohol<-as.data.frame(casos_alcohol)
alcohol<-select(.data =dtalcohol,value,Consumo.de.bebidas.alcohólicas,Comunidad.autónoma) %>%
  filter(Consumo.de.bebidas.alcohólicas=="Sí ha consumido")
alcohol<-as.data.frame(alcohol)%>%
  select(Comunidad.autónoma,value)
alcohol <- alcohol[alcohol$Comunidad.autónoma != "Total Nacional", ]
alcohol[is.na(alcohol$Comunidad_autonoma) == FALSE, ]
alcohol
```
#####Carga de datos de casos de cancer (json)
Este archivo contiene el numero de casos de cancer de España ordenados por las diferentes comunidades autónomas 

```{r}
archivo <-fromJSON("INPUT/DATA/CASOS_CANCER/casos_nuevos_de_cancer.json")
dtcancer<-as.data.frame(archivo$Respuesta$Datos$Metricas$Datos)
cancer<-select(.data=dtcancer,Parametro,Valor)
cancer
```

#####Carga de datos de porcentaje verde  por comunidades
Se han obtenido los datos a partir de un repositorio de Github.Para ello hemos obtenido datos a partir de diferentes municipios de la comunidad 
Insercción de un ejemplo de como se han obtenido los datos de un municipio

```{r}
datostorrelavega<-get_osm_data("Torrelavega,Cantabria,España")
indice_verde_torrelavega<-calculate_green_index(datostorrelavega,4326,100)
dttorrelavega<-as.data.frame(indice_verde_torrelavega)
torrelavega<-summarise(.data=dttorrelavega,areasverdes=mean(green_index_green_area,na.rm=TRUE),arboles=mean(green_index_tree,na.rm=TRUE),porcentajeverde=mean(green_index,na.rm=TRUE))

```
Aquí se encuentra la tabla completa tras haber realizado todo esto por comunidades autónomas 
```{r}
zonas_verdes
```



#####Carga de datos ejercicios físico
Este archivo contiene el número de personas que realizan ejercicio físico en España ordenados por comunidades 
```{r}
actividadfisica<-"INPUT/DATA/EJERCICIO FISICo/Porcentaje actividad física por comunidad.px"
datosactividad<-read.px(actividadfisica)
dtactividad<-as.data.frame(datosactividad)
actividad<-select(.data=dtactividad,Comunidades.y.Ciudades.Autónomas,value)
actividad <- actividad[actividad$Comunidades.y.Ciudades.Autónomas != "Total Nacional", ]
actividad
```
####Case_when actividad
Para poder realizar la unión de la actividad con el resto necesitamos realizar un case_when que nos permita obtener los parámetros de actividad igual que los del resto.Como estamos realizando una unión por comunidades en este caso vamos a cambiar estos nombres para poder realizar una unión posteriormente 


```{r}
ctividad<-actividad%>%
  mutate(.data = actividad,Comunidad_autonoma = case_when(
Comunidades.y.Ciudades.Autónomas=="08 Castilla - La Mancha" ~ 'Castilla_LaMancha',
Comunidades.y.Ciudades.Autónomas=="13 Madrid, Comunidad de" ~ 'Madrid', 
Comunidades.y.Ciudades.Autónomas=="11 Extremadura"~"Extremadura", 
Comunidades.y.Ciudades.Autónomas=="18 Ceuta"~"Ceuta", 
Comunidades.y.Ciudades.Autónomas=="19 Melilla"~"Melilla",
Comunidades.y.Ciudades.Autónomas=="04 Balears, Illes"~"Islas_Baleares",
Comunidades.y.Ciudades.Autónomas=="14 Murcia, Región de "~"Murcia",
Comunidades.y.Ciudades.Autónomas=="15 Navarra,Comunidad Foral de"~"Navarra",
Comunidades.y.Ciudades.Autónomas=="10 Comunitat Valenciana"~"Comunidad_Valenciana",
Comunidades.y.Ciudades.Autónomas=="12 Galicia"~"Galicia",
Comunidades.y.Ciudades.Autónomas=="07 Castilla y León"~"Castilla_y_Leon",
Comunidades.y.Ciudades.Autónomas=="09 Cataluña"~"Cataluna",
Comunidades.y.Ciudades.Autónomas=="06 Cantabria"~"Cantabria",
Comunidades.y.Ciudades.Autónomas=="05 Canarias"~"Islas_Canarias",
Comunidades.y.Ciudades.Autónomas=="01 Andalucía"~"Andalucia",
Comunidades.y.Ciudades.Autónomas=="02 Aragón"~"Aragon",
Comunidades.y.Ciudades.Autónomas=="03 Asturias, Principado de"~"Asturias",
Comunidades.y.Ciudades.Autónomas=="17 Rioja, La"~"Rioja",
Comunidades.y.Ciudades.Autónomas=="16 País Vasco"~"Pais_Vasco"
  ))%>%
  select(Comunidad_autonoma,value)
actividad<-ctividad
actividad

```



###Como influyen individualmente las variables 

#CASOS DE CANCER INFLUIDOS POR ALCOHHOL
Vamos a ver la correlación que tiene el cancer con la cantidad de alcohol, para ello vamos a tomar de parámetro de unión las comunidades autónomas de España que nos permitan realizar la correlación de como realmente se relacionan

```{r}
alcohol_cancer<-full_join(x=alcohol,y=cancer,by=c("Comunidad_autonoma"))%>%
  rename(casos_alcohol=value,casos_cancer=Valor)
alcohol_cancer <- alcohol_cancer[is.na(alcohol_cancer$Comunidad_autonoma) == FALSE, ]
alcohol_cancer
```
Como podemos observar las comunidades que presentan más casos de cancer son aquellas en las que más alcohol toman siendo principalmente destacables comunidades con gran número de gente alcohólica, como es el caso de Madrid,Cataluña o Andalucía donde tanto el número de casos de alcohol y de cancer son elevados,sin embargo, otras comunidades como es el caso de Cantabria o Navarra presentan mucho menos cantidad de casos de alcoholismo y vemos como considerablemente se presentan muchos menos casos de cáncer.Para ver si realmente esto esta correlacionado observamos un gráfico de correlación de estas dos variables 

```{r}
grafico_alcohol_cancer <- ggplot(alcohol_cancer, aes(x = casos_alcohol, y = casos_cancer)) +
  geom_point() +
  labs(
    title = "Relación entre Alcohol y Casos de Cáncer por Comunidades",
    x = "Casos Alcohol",
    y = "Casos de Cáncer"
  ) +
  geom_smooth(method = "loess", formula = y ~ x, color = "purple", fill = "pink", alpha = 0.3)+
  xlim(0, 1000) +
  ylim(0, 10000) +
  theme_minimal()
grafico_alcohol_cancer
```

Como podemos comprobar a mayor casos de alcohol tenemos que el número de casos de cáncer es mayor, por tanto podemos definir que estas dos variable están directamente relacionadas.


#CASOS DE CANCER INFLUIDOS POR EJERCICIO FISICO 
Vamos a ver la correlación que tiene el cancer con la cantidad de alcohol, para ello vamos a tomar de parámetro de unión las comunidades autónomas de España que nos permitan realizar la correlación de como realmente se relacionan
#CASOS DE CANCER RELACIONADOS CON ZONAS VERDES 
espana
dtcancer_largo

zonasverdes <-dplyr::rename(.data=espana,Comunidad.autonoma=Pueblo)
 
zonasverdes


comunidades<-c(
  Islas_baleares="Islas Baleares",
  Islas_canarias="Canarias",
  Castilla_y_Leon="Castilla y León",
  Castilla_LaMancha="Castilla-La Mancha",
  Cataluna="Cataluña",
  Comunidad_de_Madrid="Madrid",
  Comunidad_valenciana="Comunidad Valenciana",
  Pais_Vasco="País Vasco",
  La_Rioja="La Rioja"
)

zonasverdes$Comunidad.autonoma<-recode(zonasverdes$Comunidad.autonoma,!!!comunidades)
cancer_zonasverdes<-left_join(x=zonasverdes,y=dtcancer_largo,by=c("Comunidad.autonoma"="Parametro"))
cancer_zonasverdes
zonasverdes_cancer<-dplyr::rename(cancer_zonasverdes,casos_cancer=Valor)
zonasverdes_cancer


save.image("Objetos.RData")



```