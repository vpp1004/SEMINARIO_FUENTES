---
title: "SeminarioCancer"
author: 
- "Vanessa Pérez"
- "Carmen Gómez Peña"
date: "`r Sys.Date()`"
output: html_document
---

Enlace a repositorio de [Github](https://github.com/vpp1004/SEMINARIO_FUENTES)



### Introducción
En este seminario vamos a estudiar la enfermedad del cancer y su relación con distintas variables que pueden influir en ella positiva o negativamente en las distintas comunidades de España.
En específico, las variables que estudiaremos son los casos de personas que realizan actividad física habitualmente, los casos de consumidores habituales de alcohol y el número de zonas verdes de cada lugar.




###Objetivos 

* ¿Cómo influyen individualmente el indice verde, el alcohol y el ejercicio sobre el cáncer?

* Tiene más influencia lo considerado bueno para la salud (ejercicio y porcentaje verde) que lo malo (alcohol) sobre el cancer 
* ¿Están todas estas variables directamente relacionadas con el cancer ?


```{r setup, include=FALSE}

options(repos = c(CRAN = "https://cloud.r-project.org/"))
```
####Instalación de paquetes necesarios para el desarrollo del proyecto 
Aquí se encuentran los paquetes que hay que instalar para poder ejecutar este proyecto, en caso de tener estos paquetes ya instalados no ha de ejecutarse esta celda. 
Estos paquetes contienen funciones básicas necesarias para el tratamiento de archivos json y pcaxis que nos permiten desarrollar investigación sobre ellos 

```{r}
###  CARGA DE PAQUETES:
#install.packages("pxR")
#install.packages("tidyverse")
#install.packages("rjson")
#install.packages("tidyjson")
#install.packages("json")
#install.packages("ggplot2")
```


#### Carga de librerías necesarias para realizar el proyecto 

Una vez que se ha producido la instalación de los paquetes para poder realizar cualquier función necesitamos cargar las librerías instaladas para poder utilizarlas. La siguiente celda contiene las librerías necesarias para poder realizar el proyecto 
```{r}
library(pxR)
library(tidyverse)
library(rjson)
library(tidyjson)
library(jsonlite)
library(dplyr)
library(RJSONIO)
library(ggplot2)
```

#### Subida de archivos necesarios 
En este proyecto vamos a trabajar con diferentes archivos tanto json como pcaxis,además de trabajar con datos directamente de un repostitorio por tanton necesitamos incluir los archivos para trabajar con ellos 

#####Carga de datos de consumo de alcohol (pcaxis)
Encontramos los datos de personas que habitualmente consumen alcohol por las diferentes comunidades de España 
```{r}
casos_alcohol<-read.px("INPUT/DATA/CASOS_ALCOHOL/CasosAlcoholComunidades.px")
dtalcohol<-as.data.frame(casos_alcohol)
alcohol<-select(.data =dtalcohol,value,Consumo.de.bebidas.alcohólicas,Comunidad.autónoma) %>%
  filter(Consumo.de.bebidas.alcohólicas=="Sí ha consumido")
alcohol<-as.data.frame(alcohol)%>%
  select(Comunidad.autónoma,value)
alcohol <- alcohol[alcohol$Comunidad.autónoma != "Total Nacional", ]
alcohol[is.na(alcohol$Comunidad_autonoma) == FALSE, ]
alcohol
```
#####Carga de datos de casos de cancer (json)
Este archivo contiene el numero de casos de cancer de España ordenados por las diferentes comunidades autónomas 

```{r}
archivo <-fromJSON("INPUT/DATA/CASOS_CANCER/casos_nuevos_de_cancer.json")
dtcancer<-as.data.frame(archivo$Respuesta$Datos$Metricas$Datos)
cancer<-select(.data=dtcancer,Parametro,Valor)
cancer
```

#####Carga de datos de porcentaje verde  por comunidades
Se han obtenido los datos a partir de un repositorio de Github.Para ello hemos obtenido datos a partir de diferentes municipios de la comunidad 
Insercción de un ejemplo de como se han obtenido los datos de un municipio

```{r}
datostorrelavega<-get_osm_data("Torrelavega,Cantabria,España")
indice_verde_torrelavega<-calculate_green_index(datostorrelavega,4326,100)
dttorrelavega<-as.data.frame(indice_verde_torrelavega)
torrelavega<-summarise(.data=dttorrelavega,areasverdes=mean(green_index_green_area,na.rm=TRUE),arboles=mean(green_index_tree,na.rm=TRUE),porcentajeverde=mean(green_index,na.rm=TRUE))

```
Aquí se encuentra la tabla completa tras haber realizado todo esto por comunidades autónomas 
```{r}
zonas_verdes
```



#####Carga de datos ejercicios físico
Este archivo contiene el número de personas qeu realizan ejercicio físico en España ordenados por comunidades 
```{r}
actividadfisica<-"INPUT/DATA/EJERCICIO FISICo/Porcentaje actividad física por comunidad.px"
datosactividad<-read.px(actividadfisica)
datosactividad
dtactividad<-as.data.frame(datosactividad)
view(dtactividad)
dtactividad
actividad<-select(.data=dtactividad,Comunidades.y.Ciudades.Autónomas,value)
actividad
```


#CARGA DE DATOS DE ZONAS VERDES EN ESPAÑA POR COMUNIDADES:
Dataframe conforme a los datos de todas las comunidades Españolas. Este dataframe se ha conseguido a través de la unión y posterior media de datos de distintos pueblos de cada comunidad autónoma.
```{r}

```


#CASOS DE CANCER INFLUIDOS POR ALCOHHOL
dataalcohol
dtcancer_largo
alcohol <- dataalcohol %>%
  mutate(Comunidad.autónoma = str_remove(Comunidad.autónoma, "^\\d+\\s+")) %>%
  mutate(Comunidad.autónoma = str_replace(Comunidad.autónoma, ",.*", "")) %>% 
  mutate(Comunidad.autónoma = str_trim(Comunidad.autónoma))
alcohol_cancer<-left_join(x=alcohol,y=dtcancer_largo,by=c("Comunidad.autónoma"="Parametro"))
alcohol_cancer
cancer_alcohol<-dplyr::rename(alcohol_cancer,casos_cancer=Valor,casos_alcohol=value)
colnames(cancer_alcohol)  
cancer_alcohol


#CASOS DE CANCER INFLUIDOS POR EJERCICIO FISICO 
actividad
dtcancer_largo
cancer_actividad<-dplyr::rename(alcohol_cancer,casos_cancer=Valor,porcentaje_actividad=value)
comunidad<-c(
  "01 Andalucía"="Andalucía",
  "02 Aragón" ="Aragón",
  "03 Asturias, Principado de"="Asturias",
  "04 Balears, Illes"="Islas Baleares",
  "05 Canarias"="Canarias",
  "06 Cantabria"="Cantabria",
  "07 Castilla y León"="Castilla y León",
  "08 Castilla - La Mancha"="Castilla_La Mancha",
  "09 Cataluña"="Cataluña",
  "10 Comunitat Valenciana"="Comunidad Valenciana",
  "11 Extremadura"="Extremadura",
  "12 Galicia"="Galicia",
  "13 Madrid, Comunidad de"="Madrid",
  "14 Murcia, Región de"="Murcia",
  "15 Navarra, Comunidad Foral de"="Navarra",
  "16 País Vasco"="País Vasco",
  "17 Rioja, La"="La Rioja",
  "18 Ceuta"="Ceuta",
  "19 Melilla"="Melilla"
  
  
)

actividad$Comunidades.y.Ciudades.Autónomas<-recode(actividad$Comunidades.y.Ciudades.Autónomas,!!!comunidad)
cancer_actividad<-left_join(x=actividad,y=dtcancer_largo,by=c("Comunidades.y.Ciudades.Autónomas"="Parametro"))
cancer_actividad
actividad_cancer<-dplyr::rename(cancer_actividad,actividad_fisica=value,casos_cancer=Valor)
zonasverdes_cancer

#CASOS DE CANCER RELACIONADOS CON ZONAS VERDES 
espana
dtcancer_largo

zonasverdes <-dplyr::rename(.data=espana,Comunidad.autonoma=Pueblo)
 
zonasverdes


comunidades<-c(
  Islas_baleares="Islas Baleares",
  Islas_canarias="Canarias",
  Castilla_y_Leon="Castilla y León",
  Castilla_LaMancha="Castilla-La Mancha",
  Cataluna="Cataluña",
  Comunidad_de_Madrid="Madrid",
  Comunidad_valenciana="Comunidad Valenciana",
  Pais_Vasco="País Vasco",
  La_Rioja="La Rioja"
)

zonasverdes$Comunidad.autonoma<-recode(zonasverdes$Comunidad.autonoma,!!!comunidades)
cancer_zonasverdes<-left_join(x=zonasverdes,y=dtcancer_largo,by=c("Comunidad.autonoma"="Parametro"))
cancer_zonasverdes
zonasverdes_cancer<-dplyr::rename(cancer_zonasverdes,casos_cancer=Valor)
zonasverdes_cancer


save.image("Objetos.RData")



```