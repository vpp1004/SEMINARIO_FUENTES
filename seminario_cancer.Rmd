---
title: "SeminarioCancer"
author: 
- "Vanessa Pérez"
- "Carmen Gómez Peña"
date: "`r Sys.Date()`"
output: html_document
---

Enlace a repositorio de [Github](https://github.com/vpp1004/SEMINARIO_FUENTES)



### Introducción
En este seminario vamos a estudiar la enfermedad del cancer y su relación con distintas variables que pueden influir en ella positiva o negativamente en las distintas comunidades de España.
En específico, las variables que estudiaremos son los casos de personas que realizan actividad física habitualmente, los casos de consumidores habituales de alcohol y el número de zonas verdes de cada lugar.




###Objetivos 

* ¿Cómo influyen individualmente el indice verde, el alcohol y el ejercicio sobre el cáncer?

* Tiene más influencia lo considerado bueno para la salud (ejercicio y porcentaje verde) que lo malo (alcohol) sobre el cancer 
* ¿Están todas estas variables directamente relacionadas con el cancer ?


```{r setup, include=FALSE}

options(repos = c(CRAN = "https://cloud.r-project.org/"))
```
####Instalación de paquetes necesarios para el desarrollo del proyecto 
Aquí se encuentran los paquetes que hay que instalar para poder ejecutar este proyecto, en caso de tener estos paquetes ya instalados no ha de ejecutarse esta celda. 
Estos paquetes contienen funciones básicas necesarias para el tratamiento de archivos json y pcaxis que nos permiten desarrollar investigación sobre ellos 

```{r}
###  CARGA DE PAQUETES:
#install.packages("pxR")
#install.packages("tidyverse")
#install.packages("rjson")
#install.packages("tidyjson")
#install.packages("json")
#install.packages("ggplot2")
```


#### Carga de librerías necesarias para realizar el proyecto 

Una vez que se ha producido la instalación de los paquetes para poder realizar cualquier función necesitamos cargar las librerías instaladas para poder utilizarlas. La siguiente celda contiene las librerías necesarias para poder realizar el proyecto 
```{r}
library(pxR)
library(tidyverse)
library(rjson)
library(tidyjson)
library(jsonlite)
library(dplyr)
library(RJSONIO)
library(ggplot2)
```

#### Subida de archivos necesarios 
En este proyecto vamos a trabajar con diferentes archivos tanto json como pcaxis,además de trabajar con datos directamente de un repostitorio por tanton necesitamos incluir los archivos para trabajar con ellos 

#####Carga de datos de consumo de alcohol (pcaxis)
Encontramos los datos de personas que habitualmente consumen alcohol por las diferentes comunidades de España 
```{r}
casos_alcohol<-read.px("INPUT/DATA/CASOS_ALCOHOL/CasosAlcoholComunidades.px")
dtalcohol<-as.data.frame(casos_alcohol)
alcohol<-select(.data =dtalcohol,value,Consumo.de.bebidas.alcohólicas,Comunidad.autónoma) %>%
  filter(Consumo.de.bebidas.alcohólicas=="Sí ha consumido")
alcohol<-as.data.frame(alcohol)%>%
  select(Comunidad.autónoma,value)
alcohol <- alcohol[alcohol$Comunidad.autónoma != "Total Nacional", ]
alcohol[is.na(alcohol$Comunidad_autonoma) == FALSE, ]
alcohol
```
#####Carga de datos de casos de cancer (json)
Este archivo contiene el numero de casos de cancer de España ordenados por las diferentes comunidades autónomas 

```{r}
archivo <-fromJSON("INPUT/DATA/CASOS_CANCER/casos_nuevos_de_cancer.json")
dtcancer<-as.data.frame(archivo$Respuesta$Datos$Metricas$Datos)
cancer<-select(.data=dtcancer,Parametro,Valor)
cancer
```

#####Carga de datos de porcentaje verde  por comunidades
Se han obtenido los datos a partir de un repositorio de Github.Para ello hemos obtenido datos a partir de diferentes municipios de la comunidad 
Insercción de un ejemplo de como se han obtenido los datos de un municipio

```{r}
datostorrelavega<-get_osm_data("Torrelavega,Cantabria,España")
indice_verde_torrelavega<-calculate_green_index(datostorrelavega,4326,100)
dttorrelavega<-as.data.frame(indice_verde_torrelavega)
torrelavega<-summarise(.data=dttorrelavega,areasverdes=mean(green_index_green_area,na.rm=TRUE),arboles=mean(green_index_tree,na.rm=TRUE),porcentajeverde=mean(green_index,na.rm=TRUE))

```
Aquí se encuentra la tabla completa tras haber realizado todo esto por comunidades autónomas 
```{r}
zonas_verdes
```
Determinamos ahora que a pesar de rondar entre los mismos valores, cuales son las comunidades españolas que tienen mayor porcentaje de índice verde y cuales son las que menos 



#####Carga de datos ejercicios físico
Este archivo contiene el número de personas que realizan ejercicio físico en España ordenados por comunidades 
```{r}
actividadfisica<-"INPUT/DATA/EJERCICIO FISICo/Porcentaje actividad física por comunidad.px"
datosactividad<-read.px(actividadfisica)
dtactividad<-as.data.frame(datosactividad)
actividad<-select(.data=dtactividad,Comunidades.y.Ciudades.Autónomas,value)
actividad <- actividad[actividad$Comunidades.y.Ciudades.Autónomas != "Total Nacional", ]
actividad
```
####Case_when actividad
Para poder realizar la unión de la actividad con el resto necesitamos realizar un case_when que nos permita obtener los parámetros de actividad igual que los del resto.Como estamos realizando una unión por comunidades en este caso vamos a cambiar estos nombres para poder realizar una unión posteriormente 


```{r}
ctividad<-actividad%>%
  mutate(.data = actividad,Comunidad_autonoma = case_when(
Comunidades.y.Ciudades.Autónomas=="08 Castilla - La Mancha" ~ 'Castilla_LaMancha',
Comunidades.y.Ciudades.Autónomas=="13 Madrid, Comunidad de" ~ 'Madrid', 
Comunidades.y.Ciudades.Autónomas=="11 Extremadura"~"Extremadura", 
Comunidades.y.Ciudades.Autónomas=="18 Ceuta"~"Ceuta", 
Comunidades.y.Ciudades.Autónomas=="19 Melilla"~"Melilla",
Comunidades.y.Ciudades.Autónomas=="04 Balears, Illes"~"Islas_Baleares",
Comunidades.y.Ciudades.Autónomas=="14 Murcia, Región de "~"Murcia",
Comunidades.y.Ciudades.Autónomas=="15 Navarra,Comunidad Foral de"~"Navarra",
Comunidades.y.Ciudades.Autónomas=="10 Comunitat Valenciana"~"Comunidad_Valenciana",
Comunidades.y.Ciudades.Autónomas=="12 Galicia"~"Galicia",
Comunidades.y.Ciudades.Autónomas=="07 Castilla y León"~"Castilla_y_Leon",
Comunidades.y.Ciudades.Autónomas=="09 Cataluña"~"Cataluna",
Comunidades.y.Ciudades.Autónomas=="06 Cantabria"~"Cantabria",
Comunidades.y.Ciudades.Autónomas=="05 Canarias"~"Islas_Canarias",
Comunidades.y.Ciudades.Autónomas=="01 Andalucía"~"Andalucia",
Comunidades.y.Ciudades.Autónomas=="02 Aragón"~"Aragon",
Comunidades.y.Ciudades.Autónomas=="03 Asturias, Principado de"~"Asturias",
Comunidades.y.Ciudades.Autónomas=="17 Rioja, La"~"Rioja",
Comunidades.y.Ciudades.Autónomas=="16 País Vasco"~"Pais_Vasco"
  ))%>%
  select(Comunidad_autonoma,value)
actividad<-ctividad
actividad

```
Determinamos ahora las comunidades en las que tenemos mayor porcentaje de ejercicio físico ordenadas de mayor a menor 
```{r}
actividad<-na.omit(actividad)
grafico_actividad_fisica <- ggplot(actividad, aes(x =reorder(Comunidad_autonoma,-value), y = value, fill = value)) +
  geom_bar(stat = "identity", color = "black") +
  scale_fill_gradient(low = "aquamarine", high = "pink") +
  labs(
    title = "Porcentaje de Actividad Física por Comunidad en España",
    x = "Comunidades Autónomas",
    y = "% Actividad Física",
    fill = "%"
  ) +
  theme_minimal()+
  theme(axis.text.x =element_text(angle = 90, hjust = 1))
grafico_actividad_fisica

```
Observamos que a pesar de encontrarse rondando entre los mismos valores, Melilla, Extremadura y Asturias son las comunidades con mayor porcentaje de actividad física, superando el 40%, mientras que la Coumunidad Valenciana es la comunidad donde menos ejercicio físico se realiza, no superando el 35% 
###Como influyen individualmente las variables 

#CASOS DE CANCER INFLUIDOS POR ALCOHOL
Vamos a ver la correlación que tiene el cancer con la cantidad de alcohol, para ello vamos a tomar de parámetro de unión las comunidades autónomas de España que nos permitan realizar la correlación de como realmente se relacionan

```{r}
alcohol_cancer<-full_join(x=alcohol,y=cancer,by=c("Comunidad_autonoma"))%>%
  rename(casos_alcohol=value,casos_cancer=Valor)
alcohol_cancer <- alcohol_cancer[is.na(alcohol_cancer$Comunidad_autonoma) == FALSE, ]
alcohol_cancer
```
Como podemos observar las comunidades que presentan más casos de cancer son aquellas en las que más alcohol toman siendo principalmente destacables comunidades con gran número de gente alcohólica, como es el caso de Madrid,Cataluña o Andalucía donde tanto el número de casos de alcohol y de cancer son elevados,sin embargo, otras comunidades como es el caso de Cantabria o Navarra presentan mucho menos cantidad de casos de alcoholismo y vemos como considerablemente se presentan muchos menos casos de cáncer.Para ver si realmente esto esta correlacionado observamos un gráfico de correlación de estas dos variables 

```{r}
grafico_alcohol_cancer <- ggplot(alcohol_cancer, aes(x = casos_alcohol, y = casos_cancer)) +
  geom_point() +
  labs(
    title = "Relación entre Alcohol y Casos de Cáncer por Comunidades",
    x = "Casos Alcohol",
    y = "Casos de Cáncer"
  ) +
  geom_smooth(method = "loess", formula = y ~ x, color = "purple", fill = "pink", alpha = 0.3)+
  xlim(0, 1000) +
  ylim(0, 10000) +
  theme_minimal()
grafico_alcohol_cancer
```

Como podemos comprobar a mayor casos de alcohol tenemos que el número de casos de cáncer es mayor, por tanto podemos definir que estas dos variable están directamente relacionadas.


#CASOS DE CANCER INFLUIDOS POR EJERCICIO FISICO 
Vamos a ver la correlación que tiene el cancer con la cantidad el porcentaje medio de ejercicio físico  que se realiz,zapara ello vamos a tomar de parámetro de unión las comunidades autónomas de España que nos permitan realizar la observación de como realmente se relacionan


```{r}
actividad_cancer<- full_join(x=actividad,y=cancer,by=c("Comunidad_autonoma"))%>%
                  rename(actividad=value,casos_cancer=Valor)
actividad_cancer <- actividad_cancer[is.na(actividad_cancer$Comunidad_autonoma) == FALSE, ]
actividad_cancer

```
Como podemos comprobar aquellas comunidades con un porcentaje de ejercicio físico más alto tienden a tener generalmente menos casos de cáncer, es el caso por ejemplo de Cantabria, siendo una de las comunidades donde más porcentaje de actividad física hay y de las que menos casos de cáncer registra, por el otro lado tenemos a Madrid, que siendo una de las comunidades con el porcentaje de ejercicio físico más bajo es una de las que más casos de cáncer registro. Dado que con una tabla organizada por comunidades tenemos que guiarnos obligatoriamente por la población y tener en cuenta que comunidades como por ejemplo Madrid y Cataluña no tienen la misma cantidad de gente que Cantabria o Extremadura, vamos a observar un gráfico que nos permita determinar si estas variables están correctamente relacionadas

```{r}
gráfico_ejercicio_cancer <- ggplot(actividad_cancer, aes(x = actividad, y = casos_cancer)) +
  geom_point() +
  labs(
    title = "Relación entre Ejercicio y Casos de Cáncer por Comunidades",
    x = "% Ejercicio físico",
    y = "Casos de Cáncer"
  ) +
  geom_smooth(method = "loess", formula = y ~ x, color = "purple", fill = "aquamarine", alpha = 0.3)+
  theme_minimal()
gráfico_ejercicio_cancer
```
Como podemos determinar estas variables estan relacionadas inversamente, es decir, tal y como vemos según incrementa el porcentaje de ejercicio físico, descienden los casos de cáncer


####Casos de cáncer relacionados con porcentaje verde 
Vamos a ver la correlación que tiene el cancer con el porcentaje verde que hay en cada comunidad para  ello vamos ael tomar de parámetro de unión las comunidades autónomas de España que nos permitan realizar la observación de como realmente se relacionan

```{r}
zonasverdes_cancer<- full_join(x=zonas_verdes,y=cancer,by=c("Comunidad_autonoma"))%>%
  rename(casos_cancer=Valor)
zonasverdes_cancer <- zonasverdes_cancer[is.na(zonasverdes_cancer$Comunidad_autonoma) == FALSE, ]
zonasverdes_cancer
```

Como podemos observar el porcentaje verde de cada comunidad autónoma es muy alto, encontrándose por encima del 70% en todas las ocasiones, no pudiendo comprobar si verdaderamente se relacionan los casos de cáncer con el porcentaje verde, por tanto para ver la relación vamos a recurrir a un gráfico de correlacion 

```{r}
zonasverdes_cancer
grafico_zonas_verdes_cancer <- ggplot(zonasverdes_cancer, aes(x = porcentajeverde, y = casos_cancer)) +
  geom_point() +
  labs(
    title = "Relación entre Zonas Verdes y Casos de Cáncer por Comunidades",
    x = "% Zonas Verdes",
    y = "Casos de Cáncer"
  ) +
  geom_smooth(method = "loess", formula = y ~ x, color = "darkgreen", fill = "lightgreen", alpha = 0.3)+
  theme_minimal()
grafico_zonas_verdes_cancer

```
Como podemos observar, este gráfico presenta muchas subidas y bajadas en los casos de cáncer según sube el porcentaje de índice verde,lo cual nos permite determinar que no tiene nada que ver el factor ambiental, es decir, el porcentaje verde de la zona en la que vivas con la posibilidad que tienes de desarrollar o no cáncer.


```